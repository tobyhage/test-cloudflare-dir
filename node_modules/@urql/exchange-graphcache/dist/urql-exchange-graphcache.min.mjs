import{stringifyVariables as e,formatDocument as r,createRequest as t,makeOperation as i,stringifyDocument as a}from"@urql/core";import{Kind as n,valueFromASTUntyped as o}from"@0no-co/graphql.web";import{share as s,map as l,filter as d,merge as u,mergeMap as p,empty as v,fromArray as y,makeSubject as f,onPush as c}from"wonka";var h="\nhttps://bit.ly/2XbVrpR#";function m(e,r,t){if(!e){var i=new Error((r||"Minfied Error #"+t+"\n")+h+t);throw i.name="Graphcache Error",i}}new Set;var g={},k=e=>e._directives||g,_=e=>e.name.value,O=e=>e.typeCondition.name.value,w=e=>e.alias?e.alias.value:e.name.value,b=[],N=e=>e.selectionSet?e.selectionSet.selections:b,q=e=>e.typeCondition?e.typeCondition.name.value:null,x=(e,r)=>{var t=null;if(e.arguments)for(var i=0,a=e.arguments.length;i<a;i++){var n=e.arguments[i],s=o(n.value,r);null!=s&&(t||(t={}),t[_(n)]=s)}return t},K=(e,r)=>{if(r&&e.variableDefinitions){for(var t={},i=0,a=e.variableDefinitions.length;i<a;i++){var n=_(e.variableDefinitions[i].variable);t[n]=r[n]}return t}},E=(e,r)=>{var t={};if(!r)return t;if(e.variableDefinitions)for(var i=0,a=e.variableDefinitions.length;i<a;i++){var n=e.variableDefinitions[i],s=_(n.variable);t[s]=void 0===r[s]&&n.defaultValue?o(n.defaultValue,r):r[s]}for(var l in r)l in t||(t[l]=r[l]);return t};function S(e){for(var r=0;r<e.definitions.length;r++)if(e.definitions[r].kind===n.OPERATION_DEFINITION)return e.definitions[r];m(!1,"",1)}var M=e=>{for(var r={},t=0;t<e.definitions.length;t++){var i=e.definitions[t];i.kind===n.FRAGMENT_DEFINITION&&(r[_(i)]=i)}return r},T=(e,r)=>{var t=k(e);if(t.include||t.skip)for(var i in t){var a=t[i];if(a&&("include"===i||"skip"===i)&&a.arguments&&a.arguments[0]&&"if"===_(a.arguments[0])){var n=o(a.arguments[0].value,r);return"include"===i?!!n:!n}}return!0},A=(e,r)=>{var{defer:t}=k(e);if(t){for(var i of t.arguments||[])if("if"===_(i))return!!o(i.value,r);return!0}return!1},I=(e,r,t,i)=>{var a=C(e,r,t,i);return!!a&&"NON_NULL"!==a.type.kind},D=(e,r,t,i)=>{var a=C(e,r,t,i);if(!a)return!1;var n="NON_NULL"===a.type.kind?a.type.ofType:a.type;return"LIST"===n.kind&&"NON_NULL"!==n.ofType.kind},F=(e,r,t)=>{if(!t)return!1;var i=q(r);return!i||t===i||(e.types.has(i)&&"OBJECT"===e.types.get(i).kind?i===t:(function(e,r){m(e.types.has(r)&&("INTERFACE"===e.types.get(r).kind||"UNION"===e.types.get(r).kind),"",5)}(e,i),L(e,t),e.isSubType(i,t)))},C=(e,r,t,i)=>{if(0!==t.indexOf("__")&&0!==r.indexOf("__"))return L(e,r),e.types.get(r).fields()[t]};function L(e,r){m(e.types.has(r)&&"OBJECT"===e.types.get(r).kind,"",3)}var $=(r,t)=>t?`${r}(${e(t)})`:r,P=(e,r)=>`${e}.${r}`,R=e=>{var r=e.indexOf("(");return r>-1?{fieldKey:e,fieldName:e.slice(0,r),arguments:JSON.parse(e.slice(r+1,-1))}:{fieldKey:e,fieldName:e,arguments:null}},j=e=>{var r=e.indexOf(".");return{entityKey:e.slice(0,r).replace(/%2e/g,"."),fieldKey:e.slice(r+1)}},J=null,Q=null,B=null,U=null,G=null,V=null,z=!1,H=!1;function W(e,r){var t;if(e){if(J.has(e))return e;t=Q.get(e)}return null==t&&(t=r?[]:{}),e&&Q.set(e,t),J.add(t),t}var X=e=>!!e&&J.has(e),Y=(e,r,t,i,a)=>{J=new WeakSet,Q=new WeakMap,G=e,B=r,V=new Set,H=!!i,z=!!a,t?"read"===G?U=t:i||r.hydrating||r.optimisticOrder.length>1?(i||r.commutativeKeys.has(t)?i&&(-1===r.optimisticOrder.indexOf(t)||r.commutativeKeys.has(t)||r.optimisticOrder.splice(r.optimisticOrder.indexOf(t),1),r.commutativeKeys.delete(t)):ye(r,t),U=t,fe(r,t)):(U=null,he(r,t)):U=null},Z=()=>{var e=B,r=U;if(H=!1,U=null,!e.hydrating&&r&&e.optimisticOrder.indexOf(r)>-1)for(var t=e.optimisticOrder.length;--t>=0&&e.dirtyKeys.has(e.optimisticOrder[t])&&e.commutativeKeys.has(e.optimisticOrder[t]);)me(e.optimisticOrder[t]);J=null,Q=null,G=null,B=null,V=null,e.defer||!e.storage&&e.optimisticOrder.length||(e.defer=!0,setTimeout((()=>{Y("read",e,null),oe(),ke(),Z(),e.defer=!1})))},ee=(e,r,t)=>{r&&!t&&e.deferredKeys.delete(r),Y("write",e,r,t),Z()},re=(e,r,t,i)=>{var a=U?e.optimistic.get(U):e.base,n=a.get(r);void 0===n&&a.set(r,n=Object.create(null)),void 0!==i||U?n[t]=i:delete n[t]},te=(e,r,t)=>{for(var i,a=!H&&"read"===G&&U&&B.commutativeKeys.has(U),n=0,o=B.optimisticOrder.length;n<o;n++){var s=B.optimisticOrder[n],l=e.optimistic.get(s);if(a=a&&s!==U,l&&(!a||!B.commutativeKeys.has(s))&&(!H||"write"===G||B.commutativeKeys.has(s))&&void 0!==(i=l.get(r))&&t in i)return i[t]}return void 0!==(i=e.base.get(r))?i[t]:void 0},ie=(e,r)=>{if(Array.isArray(e))for(var t=0,i=e.length;t<i;t++)ie(e[t],r);else"string"==typeof e&&((e,r)=>{var t=B.refCount.get(e)||0,i=t+r>0?t+r:0;B.refCount.set(e,i),i?!t&&i&&B.gc.delete(e):B.gc.add(e)})(e,r)},ae=(e,r,t)=>{if(void 0!==t)for(var i in t)r.has(i)||(e.push(R(i)),r.add(i))},ne=(e,r,t,i)=>{ae(e,r,i.base.get(t));for(var a=0,n=B.optimisticOrder.length;a<n;a++){var o=i.optimistic.get(B.optimisticOrder[a]);void 0!==o&&ae(e,r,o.get(t))}},oe=()=>{if(!B.optimisticOrder.length)for(var e of B.gc.keys())if(B.gc.delete(e),!((B.refCount.get(e)||0)>0)){B.refCount.delete(e),B.records.base.delete(e);var r=B.links.base.get(e);if(r)for(var t in B.links.base.delete(e),r)ie(r[t],-1)}},se=(e,r)=>{e!==B.queryRootKey?V.add(e):void 0!==r&&"__typename"!==r&&V.add(P(e,r))},le=(e,r)=>{!H&&B.storage&&B.persist.add(((e,r)=>`${e.replace(/\./g,"%2e")}.${r}`)(e,r))},de=(e,r)=>(se(e,r),te(B.records,e,r)),ue=(e,r)=>(se(e,r),te(B.links,e,r)),pe=(e,r,t)=>{se(e,r),le(e,r),re(B.records,e,r,t)},ve=(e,r,t)=>{var i=U?B.links.optimistic.get(U):B.links.base;if(!U){var a=i&&i.get(e);ie(a&&a[r],-1),ie(t,1)}se(e,r),le(e,r),re(B.links,e,r,t)},ye=(e,r,t)=>{var i=e.optimisticOrder.indexOf(r);if(i>-1&&e.optimisticOrder.splice(i,1),t)for(e.deferredKeys.add(r),i=i>-1?i:0;i<e.optimisticOrder.length&&!e.deferredKeys.has(e.optimisticOrder[i])&&(!e.dirtyKeys.has(e.optimisticOrder[i])||!e.commutativeKeys.has(e.optimisticOrder[i]));i++);else e.deferredKeys.delete(r),i>-1&&!e.commutativeKeys.has(r)&&ce(e,r),i=0;e.optimisticOrder.splice(i,0,r),e.commutativeKeys.add(r)},fe=(e,r)=>{-1===e.optimisticOrder.indexOf(r)&&e.optimisticOrder.unshift(r),e.dirtyKeys.has(r)||(e.dirtyKeys.add(r),e.links.optimistic.set(r,new Map),e.records.optimistic.set(r,new Map))},ce=(e,r)=>{e.dirtyKeys.has(r)&&(e.dirtyKeys.delete(r),e.records.optimistic.delete(r),e.links.optimistic.delete(r),e.deferredKeys.delete(r))},he=(e,r)=>{var t=e.optimisticOrder.indexOf(r);t>-1&&(e.optimisticOrder.splice(t,1),e.commutativeKeys.delete(r)),ce(e,r)},me=e=>{var r=V;V=new Set,G="write";var t=B.links.optimistic.get(e);if(t)for(var i of t.entries()){var a=i[0],n=i[1];for(var o in n)ve(a,o,n[o])}var s=B.records.optimistic.get(e);if(s)for(var l of s.entries()){var d=l[0],u=l[1];for(var p in u)pe(d,p,u[p])}V=r,he(B,e)},ge=e=>{var{links:r,records:t}=B,i=[],a=new Set;return se(e),ne(i,a,e,r),ne(i,a,e,t),i},ke=()=>{if(B.storage){H=!0,G="read";var r={};for(var t of B.persist.keys()){var{entityKey:i,fieldKey:a}=j(t),n=void 0;r[t]=void 0!==(n=ue(i,a))?`:${e(n)}`:void 0!==(n=de(i,a))?e(n):void 0}H=!1,B.storage.writeData(r),B.persist.clear()}},_e=null,Oe=!1,we=e=>e.__internal.path.length>0&&e.__internal.errorMap?e.__internal.errorMap[e.__internal.path.join(".")]:void 0,be=(e,r,t,i,a,n)=>{var o={store:e,variables:r,fragments:t,parent:{__typename:i},parentTypeName:i,parentKey:a,parentFieldKey:"",fieldName:"",error:void 0,partial:!1,hasNext:!1,optimistic:H,__internal:{path:[],errorMap:void 0}};if(n&&n.graphQLErrors)for(var s=0;s<n.graphQLErrors.length;s++){var l=n.graphQLErrors[s];l.path&&l.path.length&&(o.__internal.errorMap||(o.__internal.errorMap=Object.create(null)),o.__internal.errorMap[l.path.join(".")]=l)}return o},Ne=(e,r,t,i,a,n)=>{_e=e,e.parent=r,e.parentTypeName=t,e.parentKey=i,e.parentFieldKey=a,e.fieldName=n,e.error=we(e)},qe=(e,r,t,i,a)=>{if(!r)return!1;var o=q(e);return!o||r===o||"write"===G||!N(e).some((e=>{if(e.kind!==n.FIELD)return!1;var r=$(_(e),x(e,i));return!((e,r)=>void 0!==de(e,r)||void 0!==ue(e,r))(t,r)}))},xe=(e,r,t,i,a)=>{var o,s=0;return function(){for(var l;o||s<i.length;)if(l=void 0,Oe=t,o){if(l=o())return l;o=void 0}else{var d=i[s++];if(T(d,a.variables))if(d.kind!==n.FIELD){var u=d.kind!==n.INLINE_FRAGMENT?a.fragments[_(d)]:d;u&&(!u.typeCondition||(a.store.schema?F(a.store.schema,u,e):qe(u,e,r,a.variables)))&&(o=xe(e,r,t||A(d,a.variables),N(u),a))}else if("write"===G||!d._generated)return d}}},Ke=e=>null==e?null:e,Ee=(e,r)=>{if(!r)return r||null;if(Array.isArray(r)){for(var t=new Array(r.length),i=0,a=t.length;i<a;i++)t[i]=Ee(e,r[i]);return t}return e.keyOfEntity(r)},Se=(e,t,i,a)=>{var n=r(t.query),o=S(n),s=e.rootFields[o.operation],l=N(o),d=be(e,E(o,t.variables),M(n),s,s,a),u=s!==d.store.rootFields.query?Me(d,s,l,i||W()):Ie(d,s,l,i||W());return{dependencies:V,partial:d.partial||!u,hasNext:d.hasNext,data:u||null}},Me=(e,r,t,i)=>{if("string"!=typeof(e.store.rootNames[r]?r:i.__typename))return i;for(var a,n=xe(r,r,Oe,t,e),o=z,s=W(i);a=n();){var l,d=w(a),u=i[d];e.__internal.path.push(d),l=a.selectionSet&&null!==u?Te(e,N(a),Ke(u)):u,o=o||l!==u,void 0!==l&&(s[d]=l),e.__internal.path.pop()}return o?s:i},Te=(e,r,t)=>{if(Array.isArray(t)){for(var i=new Array(t.length),a=z,n=0,o=t.length;n<o;n++)e.__internal.path.push(n),i[n]=Te(e,r,t[n]),a=a||i[n]!==t[n],e.__internal.path.pop();return a?i:t}if(null===t)return null;var s=e.store.keyOfEntity(t);return null!==s?Ie(e,s,r,t)||null:Me(e,t.__typename,r,t)};function Ae(e,r,t,i){var a=i.store.resolvers[r],n=a&&a[t];for(var o in e){var s=e[o];if(s&&"include"!==o&&"skip"!==o&&i.store.directives[o])return i.store.directives[o](x(s,i.variables))}return n}var Ie=(e,r,t,i,a)=>{var{store:n}=e,o=r===n.rootFields.query,s=a&&n.keyOfEntity(a)||r,l=o?r:de(s,"__typename")||a&&a.__typename;if("string"==typeof l&&(!a||l===a.__typename)){for(var d,u=xe(l,s,Oe,t,e),p=!1,v=!1,y=z,f=e.partial,c=W(i);void 0!==(d=u());){var h=_(d),m=x(d,e.variables),g=w(d),O=k(d),b=Ae(O,l,h,e),q=$(h,m),K=P(s,q),E=de(s,q),S=a?a[h]:void 0;e.__internal.path.push(g);var M=void 0;if("__typename"===h)M=l;else if(void 0!==S&&void 0===d.selectionSet)M=S;else if("read"===G&&b){var T=c;if(void 0===d.selectionSet&&void 0!==E&&(T={...c,[g]:E,[h]:E}),Ne(e,T,l,s,q,h),M=b(T,m||{},n,e),d.selectionSet&&(M=De(e,l,h,K,N(d),void 0!==c[g]?c[g]:i[g],M,X(i))),n.schema&&null===M&&!I(n.schema,l,h,e.store.logger))return}else if(d.selectionSet)if(void 0!==S)M=De(e,l,h,K,N(d),void 0!==c[g]?c[g]:i[g],S,X(i));else{var A=ue(s,q);void 0!==A?M=Fe(e,A,l,h,N(d),void 0!==c[g]?c[g]:i[g],X(i)):"object"==typeof E&&null!==E&&(M=E)}else M=E;if(!Oe&&void 0===M&&(O.optional||we(e)||n.schema&&I(n.schema,l,h,e.store.logger))?(e.partial=!0,M=null):null===M&&O.required?M=void 0:p=p||"__typename"!==h,e.__internal.path.pop(),y=y||M!==i[g],void 0!==M)c[g]=M;else{if(!Oe)return void(e.partial=f);v=!0}}return e.partial=e.partial||f,e.hasNext=e.hasNext||v,o&&e.partial&&!p?void 0:y?c:i}},De=(e,r,t,i,a,n,o,s)=>{if(Array.isArray(o)){for(var{store:l}=e,d=!!l.schema&&D(l.schema,r,t,e.store.logger),u=e.partial,p=W(n,!0),v=z||!Array.isArray(n)||o.length!==n.length,y=0,f=o.length;y<f;y++){e.__internal.path.push(y);var c=De(e,r,t,P(i,`${y}`),a,null!=n?n[y]:void 0,o[y],s);if(e.__internal.path.pop(),void 0===c&&!d)return void(e.partial=u);e.partial=e.partial||void 0===c&&d,p[y]=null!=c?c:null,v=v||p[y]!==n[y]}return v?p:n}if(null==o)return o;if(s&&null===n)return null;if(Ce(o)){var h=n||W(n);return"string"==typeof o?Ie(e,o,a,h):Ie(e,i,a,h,o)}},Fe=(e,r,t,i,a,n,o)=>{if(Array.isArray(r)){for(var{store:s}=e,l=!!s.schema&&D(s.schema,t,i,e.store.logger),d=W(n,!0),u=e.partial,p=z||!Array.isArray(n)||r.length!==n.length,v=0,y=r.length;v<y;v++){e.__internal.path.push(v);var f=Fe(e,r[v],t,i,a,null!=n?n[v]:void 0,o);if(e.__internal.path.pop(),void 0===f&&!l)return void(e.partial=u);e.partial=e.partial||void 0===f&&l,d[v]=f||null,p=p||d[v]!==n[v]}return p?d:n}return null===r||null===n&&o?null:Ie(e,r,a,n||W(n))},Ce=e=>"string"==typeof e||"object"==typeof e&&"string"==typeof e.__typename,Le=(e,t,i,a)=>{var n=r(t.query),o=S(n),s={data:i||W(),dependencies:V},l=e.rootFields[o.operation],d=be(e,E(o,t.variables),M(n),l,l,a);return $e(d,l,N(o),s.data),s},$e=(e,r,t,i)=>{var a=e.store.rootNames[r]||"query",n=!!e.store.rootNames[r],o=n?r:i.__typename;if(!o&&r&&e.optimistic&&(o=de(r,"__typename")),o){!n&&r&&pe(r,"__typename",o);for(var s,l=e.store.updates[o],d=xe(o,r||o,Oe,t,e);s=d();){var u=_(s),p=x(s,e.variables),v=$(u,p),y=w(s),f=i[e.optimistic?u:y];if(!("__typename"===u||void 0===f&&(Oe||e.optimistic&&"query"===a))){e.__internal.path.push(y);var c=void 0;if(e.optimistic&&"mutation"===a){if(!(c=e.store.optimisticMutations[u]))continue}else e.optimistic&&"function"==typeof f&&(c=f);if(c&&(Ne(e,i,o,r||o,v,u),f=Ke(c(p||{},e.store,e))),void 0!==f){if(s.selectionSet)if(r&&"query"===a){var h=P(r,v),m=Pe(e,N(s),Ke(f),h,e.optimistic?ue(r||o,v):void 0);ve(r||o,v,m)}else Pe(e,N(s),Ke(f));else r&&"query"===a&&pe(r||o,v,null===f&&we(e)?void 0:f);var g=l&&l[u];g&&(Ne(e,i,o,r||o,v,u),i[u]=f,g(i,p||{},e.store,e)),e.__internal.path.pop()}}}}},Pe=(e,r,t,i,a)=>{if(Array.isArray(t)){for(var n=new Array(t.length),o=0,s=t.length;o<s;o++){e.__internal.path.push(o);var l=i?P(i,`${o}`):void 0,d=Pe(e,r,t[o],l,null!=a?a[o]:void 0);n[o]=d,e.__internal.path.pop()}return n}if(null===t)return we(e)?void 0:null;var u=e.store.keyOfEntity(t)||("string"==typeof a?a:null)||i;return $e(e,u,r,t),u||null};class Re{constructor(e){e||(e={}),this.logger=e.logger,this.resolvers=e.resolvers||{},this.directives=e.directives||{},this.optimisticMutations=e.optimistic||{},this.keys=e.keys||{},this.globalIDs=Array.isArray(e.globalIDs)?new Set(e.globalIDs):!!e.globalIDs;var r,t="Query",i="Mutation",a="Subscription";if(e.schema){var n=(({__schema:e})=>{var r=new Map,t=e=>{var r;return()=>{if(!r){r={};for(var t=0;t<e.length;t++)r[e[t].name]=e[t]}return r}},i=e=>{switch(e.kind){case"OBJECT":case"INTERFACE":return{name:e.name,kind:e.kind,interfaces:t(e.interfaces||[]),fields:t(e.fields.map((e=>({name:e.name,type:e.type,args:t(e.args)}))))};case"UNION":return{name:e.name,kind:e.kind,types:t(e.possibleTypes||[])}}},a={query:e.queryType?e.queryType.name:null,mutation:e.mutationType?e.mutationType.name:null,subscription:e.subscriptionType?e.subscriptionType.name:null,types:void 0,isSubType(e,t){var i=r.get(e),a=r.get(t);return!!(i&&a&&("UNION"===i.kind?i.types()[t]:"OBJECT"!==i.kind&&"OBJECT"===a.kind?a.interfaces()[e]:e===t))}};if(e.types){a.types=r;for(var n=0;n<e.types.length;n++){var o=e.types[n];if(o&&o.name){var s=i(o);s&&r.set(o.name,s)}}}return a})(e.schema);t=n.query||t,i=n.mutation||i,a=n.subscription||a,n.types&&(this.schema=n)}this.updates=e.updates||{},this.rootFields={query:t,mutation:i,subscription:a},this.rootNames={[t]:"query",[i]:"mutation",[a]:"subscription"},this.data=(r=t,{hydrating:!1,defer:!1,gc:new Set,persist:new Set,queryRootKey:r,refCount:new Map,links:{optimistic:new Map,base:new Map},records:{optimistic:new Map,base:new Map},deferredKeys:new Set,commutativeKeys:new Set,dirtyKeys:new Set,optimisticOrder:[],storage:null})}keyOfField(e,r){return $(e,r)}keyOfEntity(e){if(_e&&e===_e.parent)return _e.parentKey;if(null==e||"string"==typeof e)return e||null;if(!e.__typename)return null;if(this.rootNames[e.__typename])return e.__typename;var r=null;this.keys[e.__typename]?r=this.keys[e.__typename](e)||null:null!=e.id?r=`${e.id}`:null!=e._id&&(r=`${e._id}`);var t=e.__typename;return!0===this.globalIDs||this.globalIDs&&this.globalIDs.has(t)||!r?r:`${t}:${r}`}resolve(e,r,t){var i=null,a=this.keyOfEntity(e);if(a){var n=$(r,t);void 0===(i=de(a,n))&&(i=ue(a,n))}return i}resolveFieldByKey(e,r,t){return this.resolve(e,r,t)}invalidate(e,r,t){var i=this.keyOfEntity(e);m(i,"",19),((e,r,t)=>{for(var i=r?[{fieldKey:$(r,t)}]:ge(e),a=0,n=i.length;a<n;a++){var{fieldKey:o}=i[a];void 0!==ue(e,o)?ve(e,o,void 0):pe(e,o,void 0)}})(i,r,t)}inspectFields(e){var r=this.keyOfEntity(e);return r?ge(r):[]}updateQuery(e,r){var i=t(e.query,e.variables),a=r(this.readQuery(i));null!==a&&Le(this,i,a,void 0)}readQuery(e){var r=t(e.query,e.variables);return Se(this,r,void 0,void 0).data}readFragment(e,t,i,a){return((e,r,t,i,a)=>{var n,o=M(r);if(a){if(!(n=o[a]))return null}else if(!(n=o[Object.keys(o)[0]]))return null;var s=O(n);"string"==typeof t||t.__typename||(t.__typename=s);var l=e.keyOfEntity(t);if(!l)return null;var d=be(e,i||{},o,s,l,void 0);return Ie(d,l,N(n),W())||null})(this,r(e),t,i,a)}writeFragment(e,t,i,a){((e,r,t,i,a)=>{var n,o=M(r);if(a){if(!(n=o[a]))return null}else if(!(n=o[Object.keys(o)[0]]))return null;var s=O(n),l={__typename:s,...t},d=e.keyOfEntity(l);if(d){var u=be(e,i||{},o,s,d,void 0);$e(u,d,N(n),l)}})(this,r(e),t,i,a)}link(e,r,...t){var i=2===t.length?t[0]:null,a=2===t.length?t[1]:t[0],n=this.keyOfEntity(e);n&&ve(n,$(r,i),Ee(this,a))}}var je=(e,r)=>i(e.kind,e,{...e.context,requestPolicy:r}),Je=e=>({forward:t,client:a})=>{var n=new Re(e);e&&e.storage&&(n.data.hydrating=!0,e.storage.readData().then((r=>{((e,r,t)=>{for(var i in Y("write",e,null),t){var a=t[i];if(void 0!==a){var{entityKey:n,fieldKey:o}=j(i);":"===a[0]?void 0===ue(n,o)&&ve(n,o,JSON.parse(a.slice(1))):void 0===de(n,o)&&pe(n,o,JSON.parse(a))}}e.storage=r,e.hydrating=!1,Z()})(n.data,e.storage,r),e.storage.onCacheHydrated&&e.storage.onCacheHydrated()})));var o=new Map,f=[],c=new Map,h=new Map,m=new Set,g=new Set,k=new Map,_=new Set,O=new Set,w=e=>{for(var r of e.values())if(m.has(r))return!0;return!1},b=(e,r)=>{if(r)for(var t of r.values()){var i=k.get(t);if(i)for(var a of i.values())e.add(a)}},N=(e,r,t)=>{for(var i of r.values())if(i!==e.key){var n=c.get(i);if(n){"query"===e.kind&&O.add(i);var o="cache-first";g.has(i)&&(g.delete(i),o="cache-and-network"),a.reexecuteOperation(je(n,o))}}if(!t){var s=_;"query"===e.kind&&(_=O).add(e.key),(O=s).clear()}},q=e=>{var t=!1;if("query"===e.kind)ye(n.data,e.key),c.set(e.key,e);else{if("teardown"===e.kind)return c.delete(e.key),h.delete(e.key),_.delete(e.key),ee(n.data,e.key),e;if("mutation"===e.kind&&"network-only"!==e.context.requestPolicy){c.set(e.key,e),Y("write",n.data,e.key,!0,!1);var{dependencies:a}=Le(n,e,void 0,void 0);if(Z(),a.size){for(var s of a.values())m.add(s);o.set(e.key,a);var l=new Set;b(l,a),N(e,l,!0),t=!0}}}return i(e.kind,{key:e.key,query:r(e.query),variables:e.variables?K(S(e.query),e.variables):e.variables},{...e.context,optimistic:t})},x=(e,r)=>{for(var t of r.values()){var i=k.get(t);i||k.set(t,i=new Set),i.add(e.key)}},E=e=>{Y("read",n.data,void 0,!1,!1);var r=Se(n,e,h.get(e.key),void 0);Z();var t=r.data?r.partial||r.hasNext?"partial":"hit":"miss";return h.set(e.key,r.data),c.set(e.key,e),x(e,r.dependencies),{outcome:t,operation:e,data:r.data,dependencies:r.dependencies,hasNext:r.hasNext}},M=(e,r)=>{var t,i=c.get(e.operation.key)||e.operation;if("mutation"===i.kind){var a=o.get(i.key);b(r,a),o.delete(i.key)}("subscription"===i.kind||e.hasNext)&&ye(n.data,i.key,!0);var s=e.data;if(s){Y("write",n.data,i.key,!1,!1);var l=Le(n,i,s,e.error).dependencies;Z(),b(r,l);var d="query"===i.kind?h.get(i.key):null;Y("read",n.data,i.key,!1,d!==s);var u=Se(n,i,d||s,e.error);Z(),s=u.data,"query"===i.kind&&(b(r,t=u.dependencies),h.set(i.key,s))}else ee(n.data,i.key);return t&&x(e.operation,t),{operation:i,data:s,error:e.error,extensions:e.extensions,hasNext:e.hasNext,stale:e.stale}};return e=>{var r=s(l(E)(d((e=>"query"===e.kind&&"network-only"!==e.context.requestPolicy))(e))),i=d((e=>"query"!==e.kind||"network-only"===e.context.requestPolicy))(e),h=l((e=>e.operation))(d((e=>"miss"===e.outcome&&"cache-only"!==e.operation.context.requestPolicy&&!w(e.dependencies)&&!_.has(e.operation.key)))(r)),k=l((e=>{var{requestPolicy:r}=e.operation.context,t="cache-only"!==r&&(e.hasNext||"cache-and-network"===r||"cache-first"===r&&"partial"===e.outcome&&!_.has(e.operation.key)),i={operation:e.operation,data:e.data,error:e.error,extensions:e.extensions,stale:t&&!e.hasNext,hasNext:t&&e.hasNext};return t&&(w(e.dependencies)?"cache-and-network"===r&&g.add(e.operation.key):a.reexecuteOperation(je(c.get(e.operation.key)||e.operation,"network-only"))),i}))(d((e=>"miss"!==e.outcome||"cache-only"===e.operation.context.requestPolicy))(r)),O=t(l(q)(u([i,h]))),b=l((e=>{var r=new Set,t=M(e,r);return N(e.operation,r,!1),t}))(d((e=>!o.has(e.operation.key)))(O)),x=p((e=>{if(f.push(e)<o.size)return v;for(var r=0;r<f.length;r++)ye(n.data,f[r].operation.key);m.clear();for(var t,i=[],a=new Set;t=f.shift();)i.push(M(t,a));return N(e.operation,a,!1),y(i)}))(d((e=>o.has(e.operation.key)))(O));return u([b,x,k])}},Qe={"cache-only":0,"cache-first":1,"network-only":2,"cache-and-network":3},Be=e=>r=>{var{storage:n}=e,o=e.isOfflineError||(e=>e&&e.networkError&&!e.response&&("undefined"!=typeof navigator&&!1===navigator.onLine||/request failed|failed to fetch|network\s?error/i.test(e.networkError.message)));if(n&&n.onOnline&&n.readMetadata&&n.writeMetadata){var{forward:l,client:p,dispatchDebug:v}=r,{source:y,next:h}=f(),m=[],g=!1,k=!1,_=()=>{if(g){for(var e=[],r=0;r<m.length;r++){var t=m[r];"mutation"===t.kind&&e.push({query:a(t.query),variables:t.variables,extensions:t.extensions})}n.writeMetadata(e)}},O=e=>{for(var r=m.length-1;r>=0;r--)m[r].key===e&&m.splice(r,1)},w=()=>{if(!k){var e=new Set;k=!0;for(var r=0;r<m.length;r++){var t=m[r];if("mutation"===t.kind||!e.has(t.key))if(e.add(t.key),"subscription"!==t.kind){h(i("teardown",t));for(var a="cache-first",n=0;n<m.length;n++){var{requestPolicy:o}=m[n].context;Qe[o]>Qe[a]&&(a=o)}h(je(t,a))}else h(je(t,"cache-first"))}k=!1,m.length=0,_()}},b=Je({...e,storage:{...n,readData(){var e=n.readData();return{async then(r){for(var i=await n.readMetadata(),a=0;i&&a<i.length;a++)m.push(p.createRequestOperation("mutation",t(i[a].query,i[a].variables),i[a].extensions));r(await e),n.onOnline(w),g=!0,w()}}}}})({client:p,dispatchDebug:v,forward:e=>s(d((e=>!(g&&"mutation"===e.operation.kind&&e.operation.context.optimistic&&o(e.error,e)&&(m.push(e.operation),_(),1))))(l(e)))});return e=>{var r=u([y,c((e=>{"query"!==e.kind||g?"teardown"===e.kind&&O(e.key):m.push(e)}))(e)]);return d((e=>{if("query"===e.operation.kind){if(o(e.error,e))return h(je(e.operation,"cache-only")),m.push(e.operation),!1;g||O(e.operation.key)}return!0}))(b(r))}}return Je(e)(r)};export{Re as Store,Je as cacheExchange,Be as offlineExchange};
//# sourceMappingURL=urql-exchange-graphcache.min.mjs.map
